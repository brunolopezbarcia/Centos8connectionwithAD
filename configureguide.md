# Configuring a CentOS against an Active Directory server

## Consulted pages

[https://computingforgeeks.com/join-centos-rhel-system-to-active-directory-domain/](https://computingforgeeks.com/join-centos-rhel-system-to-active-directory-domain/)
[https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/](https://www.rootusers.com/how-to-join-centos-linux-to-an-active-directory-domain/)
[https://access.redhat.com/discussions/3370851](https://access.redhat.com/discussions/3370851)

## Configuration file /etc/krb5.conf
```bash
[libdefaults]
default_realm = PRUEBA.COM
      dns_lookup_kdc = no
      dns_lookup_realm = false
      default_keytab_name = /etc/krb5.keytab
      rdns=false

; for Windows 2003
      default_tgs_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      default_tkt_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
      permitted_enctypes = rc4-hmac des-cbc-crc des-cbc-md5
udp_preference_limit = 0

; for Windows 2008 with AES
;      default_tgs_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;      default_tkt_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;      permitted_enctypes = aes256-cts-hmac-sha1-96 rc4-hmac des-cbc-crc des-cbc-md5
;
; for MIT/Heimdal kdc no need to restrict encryption type

[realms]
      PRUEBA.COM = {
              kdc = dc.prueba.com
              admin_server = dc.prueba.com
      }

[domain_realm]
      .linux.home = PRUEBA.COM
      .prueba.com = PRUEBA.COM
      prueba.com = PRUEBA.COM

[logging]
  kdc = FILE:/var/log/kdc.log
  admin_server = FILE:/var/log/kadmin.log
  default = FILE:/var/log/krb5lib.log
```

## Configuratio File /etc/sssd/sssd.conf

```bash
[sssd]
domains = prueba.com
config_file_version = 2
services = nss, pam
default_domain_suffix = prueba.com

[nss]
homedir_substring = /home

[pam]


[domain/prueba.com]
ad_domain = prueba.com
krb5_realm = PRUEBA.COM
realmd_tags = manages-system joined-with-adcli 
cache_credentials = True
id_provider = ad
krb5_store_password_if_offline = True
default_shell = /bin/bash
ldap_id_mapping = True
use_fully_qualified_names = True
fallback_homedir = /home/%u@%d
access_provider = ad
```

## Domain Name Resolve File (/etc/resolv.connf)
```bash
# Generated by NetworkManager
search prueba.com
nameserver 192.168.79.131 # Active Directory Server IP Address
```

In all these files you have to replace where to put *prueba.com* with the name of your domain; we also have to take into account that Linux is CaseSensitive, so we must take into account the letters that are in uppercase and the letters that are in lowercase and put everything as it appears in these files.

## Login

To log in with this configuration you just have to put the following:

```bash
[root@centos ~]# su - prueba2
Creating home directory for prueba2@prueba.com.
[prueba2@prueba.com@centos ~]$ id prueba2
uid=83601109(prueba2@prueba.com) gid=83600513(domain users@prueba.com) grupos=83600513(domain users@prueba.com)
[prueba2@prueba.com@centos ~]$ 
```

As we can see when making an id it tells us in the groups of the test domain in which we are.

With domain users we can also log in to the web administration interface integrated with CentOs(_Cockpit_)

![User prueba2 logged on cockpit](https://github.com/brunolopezbarcia/centostoad/blob/main/img/cockpit.jpg "Prueba2 logged on cockpit")